"use strict";(()=>{var e={};e.id=7033,e.ids=[7033],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},12515:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>v,patchFetch:()=>_,requestAsyncStorage:()=>m,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>y});var i={};r.r(i),r.d(i,{GET:()=>u,PUT:()=>p});var a=r(95419),n=r(69108),s=r(99678),o=r(78070),c=r(23917),l=r(66211),d=r(65256);async function u(e){try{let e=(await (0,l.MH)(["ADMIN","DOCTOR","RECEPTIONIST"])).user.clinicId,t=(0,c.v)(e),r=await t.raw.clinic.findUnique({where:{id:e},select:{id:!0,name:!0,address:!0,phone:!0,email:!0,logo:!0,description:!0,settings:!0}});if(!r)return o.default.json({error:"Clinic not found"},{status:404});return o.default.json(r)}catch(e){return console.error("Error fetching clinic:",e),o.default.json({error:"Internal server error"},{status:500})}}async function p(e){try{let t=(await (0,l.MH)(["ADMIN"])).user.clinicId,r=(0,c.v)(t),i=e.headers.get("content-type"),a={},n={};if(i?.includes("multipart/form-data")){let t=await e.formData(),r=t.get("logo");r&&r instanceof File?n.logo=`/${Date.now()}-${r.name}`:"string"==typeof r&&(n.logo=r);let i=t.get("data");if(i&&"string"==typeof i)try{a=JSON.parse(i)}catch(e){return console.error("Error parsing form data:",e),o.default.json({error:"Invalid form data"},{status:400})}}else a=await e.json();let s=d.Ry({name:d.Z_().min(1,"Clinic name is required"),address:d.Z_().optional().nullable(),phone:d.Z_().optional().nullable(),email:d.Z_().email("Invalid email").optional().nullable(),description:d.Z_().optional().nullable(),settings:d.IM(d.Yj()).optional()}).safeParse(a);if(!s.success)return o.default.json({error:"Validation failed",details:s.error.format()},{status:400});let u={...s.data,settings:s.data.settings?JSON.stringify(s.data.settings):void 0};void 0!==n.logo&&(u.logo=n.logo);let p=await r.raw.clinic.update({where:{id:t},data:u,select:{id:!0,name:!0,address:!0,phone:!0,email:!0,logo:!0,description:!0,settings:!0}}),f={...p,settings:p.settings?JSON.parse(p.settings):{}};return o.default.json(f)}catch(e){return console.error("Error updating clinic:",e),o.default.json({error:"Internal server error"},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/clinic/route",pathname:"/api/clinic",filename:"route",bundlePath:"app/api/clinic/route"},resolvedPagePath:"/home/hazem/Downloads/files (2)/medflow-saas-complete/medflow-saas/src/app/api/clinic/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:m,staticGenerationAsyncStorage:w,serverHooks:h,headerHooks:g,staticGenerationBailout:y}=f,v="/api/clinic/route";function _(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:w})}},81147:(e,t,r)=>{r.d(t,{HT:()=>f,I8:()=>d,a4:()=>m});var i=r(78554),a=r(65822),n=r(53524),s=r(3133),o=r(6521);let c=new n.PrismaClient,{handlers:l,auth:d,signIn:u,signOut:p}=(0,i.ZP)({adapter:(0,a.N)(c),session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET||"your-secret-key",debug:!1,trustHost:!0,pages:{signIn:"/auth/login",error:"/auth/login"},callbacks:{session:async({session:e,token:t})=>(e.user&&(e.user.id=t.sub,e.user.role=t.role,e.user.clinicId=t.clinicId,e.user.clinicName=t.clinicName),e),jwt:async({token:e,user:t})=>(t&&(e.role=t.role,e.clinicId=t.clinicId,e.clinicName=t.clinicName),e)},providers:[(0,s.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{let t=await c.user.findUnique({where:{email:e.email},include:{clinic:!0}});if(!t||!t.password||!await (0,o.compare)(e.password,t.password))return null;return{id:t.id,email:t.email,name:[t.firstName,t.lastName].filter(Boolean).join(" ")||t.email.split("@")[0],role:t.role,clinicId:t.clinicId,clinicName:t.clinic?.name||void 0}}catch(e){return console.error("Authentication error:",e),null}}})]}),{GET:f,POST:m}=l},66211:(e,t,r)=>{r.d(t,{MH:()=>l,j7:()=>c,mk:()=>o,t0:()=>s});var i=r(78070),a=r(81147),n=r(14307);async function s(){try{return await (0,a.I8)()}catch(e){return null}}async function o(){let e=await s();if(!e?.user)throw new i.default(JSON.stringify({error:"Unauthorized"}),{status:401});try{await (0,n.Q)(e.user.clinicId)}catch(e){console.warn("setCurrentClinic failed",e)}return e}async function c(e){let t=(await o()).user.clinicId;return(0,n.I)(t,e)}async function l(e=[]){let t=await o(),r=t.user.role;if(!e.includes(r))throw new i.default(JSON.stringify({error:"Forbidden"}),{status:403});return t}},14307:(e,t,r)=>{r.d(t,{I:()=>n,Q:()=>a});var i=r(34490);async function a(e){if(e)try{await i._.$executeRawUnsafe(`select set_config('medflow.current_clinic', '${e}', true);`)}catch(e){console.warn("Failed to set DB session clinic id for RLS:",e)}}async function n(e,t){if(!e)throw Error("clinicId required for runWithClinicTransaction");return i._.$transaction(async r=>{try{await r.$executeRawUnsafe(`select set_config('medflow.current_clinic', '${e}', true);`)}catch(e){console.warn("Failed to set session clinic in transaction",e)}return t(r)})}},23917:(e,t,r)=>{r.d(t,{v:()=>a});var i=r(34490);function a(e){if(!e)throw Error("clinicId is required for scoped prisma");return{patient:{findMany:(t={})=>i._.patient.findMany({where:{clinicId:e,...t.where||{}},...t||{}}),findUnique:t=>i._.patient.findFirst({where:{clinicId:e,...t.where||{}},...t||{}}),create:t=>i._.patient.create({data:{...t,clinicId:e}}),update:e=>i._.patient.update({where:{id:e.where.id},data:e.data}),delete:e=>i._.patient.delete({where:{id:e.where.id}})},appointment:{findMany:(t={})=>i._.appointment.findMany({where:{clinicId:e,...t.where||{}},...t||{}}),create:t=>i._.appointment.create({data:{...t,clinicId:e}}),update:e=>i._.appointment.update({where:{id:e.where.id},data:e.data})},service:{findMany:(t={})=>i._.service.findMany({where:{clinicId:e,...t.where||{}},...t||{}}),create:t=>i._.service.create({data:{...t,clinicId:e}})},invoice:{findMany:(t={})=>i._.invoice.findMany({where:{clinicId:e,...t.where||{}},...t||{}}),create:t=>i._.invoice.create({data:{...t,clinicId:e}})},raw:i._}}},34490:(e,t,r)=>{r.d(t,{_:()=>a});var i=r(53524);let a=globalThis.prisma??new i.PrismaClient({log:["error"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[1638,8070,6521,9888,8763],()=>r(12515));module.exports=i})();